var EaasClient=EaasClient||{};
EaasClient.Client=function(a,e){function f(a){var b=Array.prototype.slice.call(arguments,1);return a.replace(/{(\d+)}/g,function(a,c){return"undefined"!=typeof b[c]?b[c]:a})}var d=a.replace(/([^:])(\/\/+)/g,"$1/");this.pollState=function(a,c){$.get(a+"/state").done(function(b){if("running"==b.state){if(!this.guac&&(this.establishGuacamoleTunnel(a),this.keepaliveIntervalId=setInterval(this.keepalive.bind(this,c),1E3),this.onConnect))this.onConnect();setTimeout(this.pollState.bind(this),1E3,a,c)}else"failed"==
b.state?this._onError("An internal server error occurred"):"client_fault"==b.state?this._onError("A client error occurred"):"stopped"==b.state?this._onError("The emulator was stopped"):setTimeout(this.pollState.bind(this),1E3,a,c)}.bind(this)).fail(function(a,b,c){this._onError("Could not determine component state")}.bind(this))};this._onError=function(a){this.keepaliveIntervalId&&clearInterval(this.keepaliveIntervalId);this.guac&&this.guac.disconnect();if(this.onError)this.onError(a||"No error message specified")};
this._onResize=function(a,c){e.style.width=a;e.style.height=c;if(this.onResize)this.onResize(a,c)};this.keepalive=function(a){$.post(d+f("/{0}/keepalive",a))};this.establishGuacamoleTunnel=function(a){window.onbeforeunload=function(){this.guac.disconnect()}.bind(this);$.fn.focusWithoutScrolling=function(){var a=window.scrollX,b=window.scrollY;this.focus();window.scrollTo(a,b);return this};this.guac=new Guacamole.Client(new Guacamole.HTTPTunnel(a+"/tunnel"));a=this.guac.getDisplay().getElement();BWFLA.hideClientCursor(this.guac);
e.prepend(a);BWFLA.registerEventCallback(this.guac.getDisplay(),"resize",this._onResize.bind(this));this.guac.connect();var c=new Guacamole.Mouse(a),b=new Guacamole.Mouse.Touchpad(a),d=new BwflaMouse(this.guac);c.onmousedown=b.onmousedown=d.onmousedown;c.onmouseup=b.onmouseup=d.onmouseup;c.onmousemove=b.onmousemove=d.onmousemove;c=new Guacamole.Keyboard(a);c.onkeydown=function(a){this.guac.sendKeyEvent(1,a)}.bind(this);c.onkeyup=function(a){this.guac.sendKeyEvent(0,a)}.bind(this);$(a).attr("tabindex",
"0");$(a).css("outline","0");$(a).mouseenter(function(){$(this).focusWithoutScrolling()});if(this.onReady)this.onReady()};this.startEnvironment=function(a,c,g){$.get(d+f("/configureEnv?envId\x3d{0}\x26language\x3d{1}\x26layout\x3d{2}",a,c||"us",g||"pc105")).done(function(a){0==a.status?this.pollState(a.iframeurl.replace(/([^:])(\/\/+)/g,"$1/"),a.id):this._onError(a.message)}.bind(this)).fail(function(a,b,c){this._onError($.parseJSON(a.responseText).message)}.bind(this))}};var BWFLA=BWFLA||{};
BWFLA.registerEventCallback=function(a,e,f){var d="on"+e;if(d in a){"__bwFlaEventHandlers__"in a||(a.constructor.prototype.__bwFlaEventHandlers__={});d in a.__bwFlaEventHandlers__||(a.__bwFlaEventHandlers__[d]=[]);var b=a.__bwFlaEventHandlers__[d];b.push(f);null==a[d]&&(a[d]=function(){var c=arguments;b.forEach(function(b){b.apply(a,c)})})}else console.error("Event "+e+" not supported!")};
BWFLA.unregisterEventCallback=function(a,e,f){"__bwFlaEventHandlers__"in a&&(a=a.__bwFlaEventHandlers__["on"+e],null!=a&&(f=a.indexOf(f),-1<f&&a.splice(f,1)))};
var BwflaMouse=function(a){function e(a){a=new Guacamole.Mouse.State(a.x,a.y,a.left,a.middle,a.right,a.up,a.down);d.push(a)}function f(){for(;0<d.length;)a.sendMouseState(d.shift());b=null;c=!1}var d=[],b=null,c=!1;this.onmousedown=function(a){null!=b&&window.clearTimeout(b);b=window.setTimeout(f,100);e(a);c=!0};this.onmouseup=function(a){null!=b&&window.clearTimeout(b);b=window.setTimeout(f,150);e(a);c=!0};this.onmousemove=function(b){1==c?e(b):a.sendMouseState(b)}},BWFLA=BWFLA||{};
BWFLA.requestPointerLock=function(a,e){function f(){"pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document?(a.requestPointerLock=a.requestPointerLock||a.mozRequestPointerLock||a.webkitRequestPointerLock,a.requestPointerLock()):(console.warn("Your browser does not support the PointerLock API!\nUsing relative mouse is not possible.\n\nMouse input will be disabled for this virtual environment."),alert("Your browser does not support the PointerLock API!\nUsing relative mouse is not possible.\n\nMouse input will be disabled for this virtual environment."))}
function d(){document.pointerLockElement===a||document.mozPointerLockElement===a||document.webkitPointerLockElement===a?(console.debug("Pointer was locked!"),a.isPointerLockEnabled=!0,a.removeEventListener(e,f,!1)):(console.debug("Pointer was unlocked."),a.isPointerLockEnabled=!1,a.addEventListener(e,f,!1))}function b(a){console.warn("Pointer lock failed!");alert("Pointer lock failed!")}document.addEventListener("pointerlockchange",d,!1);document.addEventListener("mozpointerlockchange",d,!1);document.addEventListener("webkitpointerlockchange",
d,!1);document.addEventListener("pointerlockerror",b,!1);document.addEventListener("mozpointerlockerror",b,!1);document.addEventListener("webkitpointerlockerror",b,!1);a.addEventListener(e,f,!1);a.isRelativeMouse=!0};BWFLA.hideClientCursor=function(a){a.getDisplay().showCursor(!1)};BWFLA.showClientCursor=function(a){a.getDisplay().showCursor(!0)};